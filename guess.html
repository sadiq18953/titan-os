<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="theme-color" content="#000000" />
    <title>TITAN GUESS</title>
    <style>
      /* --- TITAN OS DESIGN SYSTEM --- */
      :root {
        --bg-dark: #000000;
        --bg-gradient: radial-gradient(
          circle at 50% 0%,
          #1a1b26 0%,
          #000000 100%
        );
        --glass-panel: rgba(20, 20, 25, 0.7);
        --glass-border: rgba(255, 255, 255, 0.08);
        --accent: #3b82f6;
        --accent-glow: rgba(59, 130, 246, 0.4);
        --text-main: #ffffff;
        --text-muted: #94a3b8;
        --success: #10b981;
        --danger: #ef4444;
        --radius: 24px;
        --ease: cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        user-select: none;
      }

      body {
        margin: 0;
        background: var(--bg-dark);
        background-image: var(--bg-gradient);
        color: var(--text-main);
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        overflow-x: hidden;
      }

      /* Ambient Background */
      .ambient {
        position: fixed;
        top: -20%;
        left: -20%;
        width: 80%;
        height: 60%;
        background: radial-gradient(
          circle,
          rgba(59, 130, 246, 0.15),
          transparent 70%
        );
        filter: blur(80px);
        z-index: -1;
        animation: float 10s infinite ease-in-out;
      }
      @keyframes float {
        0%,
        100% {
          transform: translate(0, 0);
        }
        50% {
          transform: translate(20px, 40px);
        }
      }

      /* HEADER */
      .app-header {
        padding: 15px 20px;
        padding-top: max(15px, env(safe-area-inset-top));
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .back-btn {
        text-decoration: none;
        color: var(--text-main);
        font-weight: 600;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
        background: rgba(255, 255, 255, 0.1);
        padding: 8px 16px;
        border-radius: 20px;
      }

      /* MAIN LAYOUT */
      main.wrap {
        display: grid;
        grid-template-columns: 1fr 320px; /* Desktop: Side-by-side */
        gap: 20px;
        padding: 20px;
        max-width: 1000px;
        margin: 0 auto;
        width: 100%;
      }

      /* MOBILE RESPONSIVE LAYOUT */
      @media (max-width: 800px) {
        main.wrap {
          grid-template-columns: 1fr; /* Mobile: Stacked */
          padding: 15px;
          padding-bottom: 80px;
        }
      }

      /* CARDS */
      .game-card,
      .sidebar {
        background: var(--glass-panel);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: var(--radius);
        padding: 24px;
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5);
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
      }
      .logo {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, var(--accent), #60a5fa);
        border-radius: 14px;
        display: grid;
        place-items: center;
        font-weight: 900;
        font-size: 20px;
        box-shadow: 0 0 20px var(--accent-glow);
      }
      h1 {
        margin: 0;
        font-size: 1.2rem;
        font-weight: 800;
        letter-spacing: -0.5px;
      }
      .lead {
        margin: 2px 0 0;
        font-size: 0.8rem;
        color: var(--text-muted);
      }

      /* GAMEPLAY AREA */
      .top-row {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
      }

      #secretBox {
        width: 100px;
        height: 100px;
        flex-shrink: 0;
        background: rgba(0, 0, 0, 0.3);
        border: 2px dashed rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        font-weight: 800;
        color: rgba(255, 255, 255, 0.2);
        transition: all 0.3s var(--ease);
      }
      #secretBox.revealed {
        background: var(--success);
        border-style: solid;
        border-color: transparent;
        color: white;
        transform: scale(1.05);
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        box-shadow: 0 0 30px rgba(16, 185, 129, 0.4);
      }

      .meta {
        flex: 1;
      }
      .pills {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 8px;
      }
      .pill {
        background: rgba(255, 255, 255, 0.05);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        color: var(--text-muted);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      .pill span {
        color: white;
        margin-left: 5px;
      }

      .progress {
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        overflow: hidden;
      }
      .progress > i {
        display: block;
        height: 100%;
        background: var(--accent);
        transition: width 0.3s ease;
      }

      /* INPUTS */
      .input-area {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      input[type="number"] {
        flex: 1;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid var(--glass-border);
        color: white;
        padding: 14px;
        border-radius: 14px;
        font-size: 16px; /* 16px prevents iOS zoom */
        font-weight: 600;
        text-align: center;
        outline: none;
        transition: 0.3s;
      }
      input[type="number"]:focus {
        border-color: var(--accent);
        box-shadow: 0 0 15px var(--accent-glow);
      }

      .btn {
        background: var(--accent);
        color: white;
        border: none;
        padding: 0 20px;
        border-radius: 14px;
        font-weight: 700;
        cursor: pointer;
        font-size: 14px;
        transition: 0.2s;
      }
      .btn:active {
        transform: scale(0.95);
      }

      .controls-row {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        overflow-x: auto;
        padding-bottom: 5px;
      }
      .btn.ghost {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--glass-border);
        white-space: nowrap;
        padding: 10px 16px;
      }

      /* MESSAGE BOX */
      .message {
        margin-top: 15px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 14px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        font-size: 14px;
        border: 1px solid rgba(255, 255, 255, 0.02);
      }

      /* SIDEBAR (HISTORY) */
      .sidebar h3 {
        margin: 0 0 15px 0;
        font-size: 14px;
        text-transform: uppercase;
        color: var(--text-muted);
        letter-spacing: 1px;
      }

      .attempts-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 250px;
        overflow-y: auto;
      }
      .attempt {
        background: rgba(255, 255, 255, 0.03);
        padding: 10px 14px;
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
        font-weight: 600;
      }
      .attempt .badge {
        background: rgba(255, 255, 255, 0.1);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 11px;
      }

      /* Small controls footer */
      .small-controls {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 8px;
        margin-top: 15px;
      }
      .small {
        background: transparent;
        border: 1px solid var(--glass-border);
        color: var(--text-muted);
        padding: 8px;
        border-radius: 8px;
        font-size: 11px;
        cursor: pointer;
        font-weight: 600;
      }

      /* CONFETTI ANIMATION */
      .confetti {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 999;
      }
      .confetti span {
        position: absolute;
        width: 8px;
        height: 12px;
        opacity: 0;
        animation: pop 1.5s ease-out forwards;
      }
      body.celebrate .confetti span {
        opacity: 1;
      }

      @keyframes pop {
        0% {
          transform: translateY(0) rotate(0);
          opacity: 1;
        }
        100% {
          transform: translateY(80vh) rotate(720deg);
          opacity: 0;
        }
      }

      /* Lost State */
      body.lost #secretBox {
        border-color: var(--danger);
        color: var(--danger);
      }
    </style>
  </head>
  <body>
    <div class="ambient"></div>

    <header class="app-header">
      <a href="index.html" class="back-btn">
        <svg
          width="16"
          height="16"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path d="M15 18l-6-6 6-6" />
        </svg>
        OS
      </a>
      <div style="font-weight: 700; font-size: 14px; letter-spacing: 1px">
        GUESS
      </div>
      <div style="width: 40px"></div>
    </header>

    <main class="wrap">
      <section class="game-card">
        <div class="brand">
          <div class="logo">?</div>
          <div>
            <h1>Titan Guess</h1>
            <p class="lead">Crack the code (1-20)</p>
          </div>
        </div>

        <div class="top-row">
          <div id="secretBox">?</div>
          <div class="meta">
            <div class="pills">
              <div class="pill">Score: <span id="scoreValue">20</span></div>
              <div class="pill">Best: <span id="highscoreValue">0</span></div>
            </div>
            <div class="progress">
              <i id="scoreBar" style="width: 100%"></i>
            </div>
          </div>
        </div>

        <form id="guessForm" class="input-area" onsubmit="return false;">
          <input
            id="userGuess"
            type="number"
            min="1"
            max="20"
            placeholder="Number 1-20"
            inputmode="numeric"
          />
          <button id="submitBtn" class="btn" type="button">SUBMIT</button>
        </form>

        <div class="controls-row">
          <button id="againBtn" class="btn ghost">â†» Again</button>
          <button id="hintBtn" class="btn ghost">ðŸ’¡ Hint</button>
          <button id="soundToggle" class="btn ghost">ðŸ”Š</button>
        </div>

        <div id="message" class="message">
          <span class="emoji">ðŸ¤”</span>
          <span id="messageText">Start guessing...</span>
        </div>
      </section>

      <aside class="sidebar">
        <h3>Round History</h3>
        <div class="attempts-list" id="attemptsList">
          <div class="attempt" style="justify-content: center; opacity: 0.5">
            No attempts yet
          </div>
        </div>

        <div class="small-controls">
          <button id="revealBtn" class="small">Reveal</button>
          <button id="resetBtn" class="small">Clear Data</button>
          <button id="shareBtn" class="small">Share</button>
        </div>

        <div
          style="
            font-size: 11px;
            color: rgba(255, 255, 255, 0.3);
            margin-top: 15px;
            text-align: center;
          "
        >
          Last played: <span id="lastPlayed">Never</span>
        </div>
      </aside>
    </main>

    <div class="confetti">
      <span style="left: 10%; background: #ff4444; animation-delay: 0s"></span>
      <span
        style="left: 30%; background: #44ff44; animation-delay: 0.2s"
      ></span>
      <span
        style="left: 50%; background: #4444ff; animation-delay: 0.4s"
      ></span>
      <span
        style="left: 70%; background: #ffff44; animation-delay: 0.1s"
      ></span>
      <span
        style="left: 90%; background: #ff44ff; animation-delay: 0.3s"
      ></span>
    </div>

    <script>
      const STORAGE_KEY = "guessmy:state:v1";

      const gameState = {
        config: {
          min: 1,
          max: 20,
          startScore: 20,
          hintPenalty: 1,
          maxHints: 2,
          localStorageKey: STORAGE_KEY,
          maxStoredRounds: 20,
        },
        runtime: {
          secret: null,
          score: 20,
          attempts: [],
          finished: false,
          hintsUsed: 0,
          startTimestamp: null,
        },
        persisted: { highscore: 0, rounds: [], lastPlayed: null },
        ui: { soundOn: true },
      };

      /* Utilities */
      function randomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function loadPersistedState() {
        try {
          const raw = localStorage.getItem(gameState.config.localStorageKey);
          if (!raw) return;
          const parsed = JSON.parse(raw);
          if (parsed && typeof parsed === "object") {
            if (typeof parsed.highscore === "number")
              gameState.persisted.highscore = parsed.highscore;
            if (Array.isArray(parsed.rounds))
              gameState.persisted.rounds = parsed.rounds.slice(
                0,
                gameState.config.maxStoredRounds,
              );
            if (parsed.lastPlayed)
              gameState.persisted.lastPlayed = parsed.lastPlayed;
            if (parsed.ui && typeof parsed.ui.soundOn === "boolean")
              gameState.ui.soundOn = parsed.ui.soundOn;
          }
        } catch (err) {
          console.warn("Failed to load state", err);
        }
      }

      function savePersistedState() {
        try {
          const toSave = {
            highscore: gameState.persisted.highscore,
            rounds: gameState.persisted.rounds.slice(
              0,
              gameState.config.maxStoredRounds,
            ),
            lastPlayed: gameState.persisted.lastPlayed,
            ui: { soundOn: gameState.ui.soundOn },
          };
          localStorage.setItem(
            gameState.config.localStorageKey,
            JSON.stringify(toSave),
          );
        } catch (err) {
          console.warn("Failed to save state", err);
        }
      }

      function formatTimestamp(iso) {
        try {
          return new Date(iso).toLocaleString();
        } catch {
          return iso;
        }
      }

      function byId(id) {
        return document.getElementById(id);
      }

      function updateScoreUI() {
        const scoreValueEl = byId("scoreValue");
        const scoreBarEl = byId("scoreBar");
        const score = gameState.runtime.score;
        scoreValueEl.textContent = String(score);
        const pct = Math.max(
          0,
          Math.min(
            100,
            Math.round((score / gameState.config.startScore) * 100),
          ),
        );
        if (scoreBarEl) scoreBarEl.style.width = pct + "%";
      }

      function updateMessage(text, emoji = "ðŸ¤”") {
        const msgText = byId("messageText");
        const msg = byId("message");
        if (!msgText) return;
        msgText.textContent = text;
        const emojiEl = msg ? msg.querySelector(".emoji") : null;
        if (emojiEl) emojiEl.textContent = emoji;
      }

      function clearAttemptsUI() {
        const list = byId("attemptsList");
        if (list) list.innerHTML = "";
      }

      function appendAttemptUI(attempt) {
        const list = byId("attemptsList");
        if (!list) return;
        // Clear default message if it exists
        if (
          list.children.length > 0 &&
          list.children[0].innerText === "No attempts yet"
        )
          list.innerHTML = "";

        const node = document.createElement("div");
        node.className = "attempt";

        const left = document.createElement("div");
        left.textContent = `#${gameState.runtime.attempts.length} â€” ${attempt.guess}`;

        const right = document.createElement("div");
        right.className = "badge";
        right.textContent = attempt.message || attempt.result;

        node.appendChild(left);
        node.appendChild(right);
        list.prepend(node); // Add to top for easier mobile viewing
      }

      function revealSecretUI() {
        const secretBox = byId("secretBox");
        if (!secretBox) return;
        secretBox.classList.add("revealed");
        secretBox.textContent = String(gameState.runtime.secret);
      }

      function hideSecretUI() {
        const secretBox = byId("secretBox");
        if (!secretBox) return;
        secretBox.classList.remove("revealed");
        secretBox.textContent = "?";
      }

      function validateInput(raw) {
        const r = String(raw || "").trim();
        if (r === "") return { ok: false, error: "Enter a number (1â€“20)." };
        const n = Number(r);
        if (!Number.isFinite(n)) return { ok: false, error: "Invalid number." };
        const intVal = Math.trunc(n);
        if (intVal < gameState.config.min || intVal > gameState.config.max) {
          return {
            ok: false,
            error: `Range is ${gameState.config.min}â€“${gameState.config.max}.`,
          };
        }
        return { ok: true, value: intVal };
      }

      function makeAttempt(guess, result, message) {
        return {
          id: `${Date.now()}-${Math.floor(Math.random() * 1000)}`,
          guess,
          result,
          message,
          scoreAfter: gameState.runtime.score,
          time: new Date().toISOString(),
        };
      }

      function persistRoundSummary(success) {
        const summary = {
          date: new Date().toISOString(),
          score: gameState.runtime.score,
          attempts: gameState.runtime.attempts.length,
          success: !!success,
        };
        gameState.persisted.rounds.unshift(summary);
        gameState.persisted.lastPlayed = summary.date;
        savePersistedState();
      }

      function checkGuessFromInput() {
        const inp = byId("userGuess");
        const v = validateInput(inp.value);
        if (!v.ok) {
          updateMessage(v.error, "âš ï¸");
          return;
        }

        const guess = v.value;
        inp.value = ""; // Clear input for better mobile UX

        if (gameState.runtime.finished) {
          updateMessage("Press 'Again' to restart.", "â„¹ï¸");
          return;
        }

        if (guess === gameState.runtime.secret) {
          const attempt = makeAttempt(guess, "correct", `Correct!`);
          gameState.runtime.attempts.push(attempt);
          appendAttemptUI(attempt);
          updateMessage(`Correct! It was ${gameState.runtime.secret}.`, "ðŸŽ‰");
          gameState.runtime.finished = true;
          revealSecretUI();

          if (gameState.runtime.score > gameState.persisted.highscore) {
            gameState.persisted.highscore = gameState.runtime.score;
            savePersistedState();
            byId("highscoreValue").textContent = String(
              gameState.persisted.highscore,
            );
          }

          persistRoundSummary(true);
          document.body.classList.add("celebrate");
          setTimeout(() => document.body.classList.remove("celebrate"), 3000);
          return;
        }

        gameState.runtime.score = Math.max(0, gameState.runtime.score - 1);
        const res = guess > gameState.runtime.secret ? "high" : "low";
        const msg = guess > gameState.runtime.secret ? "Too high" : "Too low";
        const attempt = makeAttempt(guess, res, msg);

        gameState.runtime.attempts.push(attempt);
        appendAttemptUI(attempt);
        updateScoreUI();
        updateMessage(msg, res === "high" ? "ðŸ“ˆ" : "ðŸ“‰");

        if (gameState.runtime.score <= 0) {
          gameState.runtime.finished = true;
          updateMessage(`Game Over. It was ${gameState.runtime.secret}.`, "ðŸ’€");
          revealSecretUI();
          persistRoundSummary(false);
          document.body.classList.add("lost");
        }
      }

      function resetRound(preserveHighscore = true) {
        document.body.classList.remove("celebrate", "lost");
        gameState.runtime.secret = randomInt(
          gameState.config.min,
          gameState.config.max,
        );
        gameState.runtime.score = gameState.config.startScore;
        gameState.runtime.attempts = [];
        gameState.runtime.finished = false;
        gameState.runtime.hintsUsed = 0;
        gameState.runtime.startTimestamp = new Date().toISOString();

        hideSecretUI();
        clearAttemptsUI();
        updateScoreUI();
        updateMessage("Start guessing...", "ðŸ¤”");

        const inp = byId("userGuess");
        if (inp) {
          inp.value = "";
          inp.disabled = false;
        }
        const btn = byId("submitBtn");
        if (btn) btn.disabled = false;

        const lastEl = byId("lastPlayed");
        if (lastEl && gameState.persisted.lastPlayed)
          lastEl.textContent = formatTimestamp(gameState.persisted.lastPlayed);
      }

      function renderLeaderboard() {
        const hiscoreEl = byId("highscoreValue");
        if (hiscoreEl)
          hiscoreEl.textContent = String(gameState.persisted.highscore || 0);

        const lastEl = byId("lastPlayed");
        if (lastEl && gameState.persisted.lastPlayed)
          lastEl.textContent = formatTimestamp(gameState.persisted.lastPlayed);
      }

      function initGame(options = {}) {
        loadPersistedState();

        const soundBtn = byId("soundToggle");
        if (soundBtn) soundBtn.textContent = gameState.ui.soundOn ? "ðŸ”Š" : "ðŸ”‡";

        byId("submitBtn").addEventListener("click", () =>
          checkGuessFromInput(),
        );
        byId("guessForm").addEventListener("submit", (ev) => {
          ev.preventDefault();
          checkGuessFromInput();
        });
        byId("againBtn").addEventListener("click", () => resetRound(true));
        byId("revealBtn").addEventListener("click", revealSecretUI);

        byId("resetBtn").addEventListener("click", () => {
          if (confirm("Reset data?")) {
            gameState.persisted.highscore = 0;
            gameState.persisted.rounds = [];
            savePersistedState();
            renderLeaderboard();
            updateMessage("Data reset.", "ðŸ—‘ï¸");
          }
        });

        byId("hintBtn").addEventListener("click", () => {
          if (gameState.runtime.hintsUsed >= gameState.config.maxHints) {
            updateMessage("No hints left.", "âš ï¸");
            return;
          }
          const s = gameState.runtime.secret;
          const low = Math.max(gameState.config.min, s - 3);
          const high = Math.min(gameState.config.max, s + 3);
          gameState.runtime.hintsUsed++;
          gameState.runtime.score = Math.max(0, gameState.runtime.score - 1);
          updateScoreUI();
          updateMessage(`Try between ${low} and ${high}`, "ðŸ’¡");
        });

        byId("soundToggle").addEventListener("click", () => {
          gameState.ui.soundOn = !gameState.ui.soundOn;
          savePersistedState();
          byId("soundToggle").textContent = gameState.ui.soundOn ? "ðŸ”Š" : "ðŸ”‡";
        });

        byId("shareBtn").addEventListener("click", async () => {
          const txt = `Titan Guess: Highscore ${gameState.persisted.highscore}`;
          if (navigator.share)
            await navigator.share({ title: "Titan Guess", text: txt });
          else alert("Copied: " + txt);
        });

        resetRound(true);
        renderLeaderboard();
      }

      if (document.readyState === "loading")
        document.addEventListener("DOMContentLoaded", () => initGame());
      else initGame();
    </script>
  </body>
</html>
